!function($,document,window,navigator){"use strict";var H=$("html"),B=$("body"),W=$(window),D=$(document),DP=$.DatePicker=function(){DP.init.apply(this,arguments)},IE=navigator.userAgent.match(/msie/i),isQuery=function(e){return e&&e.hasOwnProperty&&e instanceof $},isString=function(e){return e&&"string"===$.type(e)},isPercentage=function(e){return isString(e)&&e.indexOf("%")>0},isScrollable=function(e){return e&&!(e.style.overflow&&"hidden"===e.style.overflow)&&(e.clientWidth&&e.scrollWidth>e.clientWidth||e.clientHeight&&e.scrollHeight>e.clientHeight)},getScalar=function(e,t){var a=parseInt(e,10)||0;return t&&isPercentage(e)&&(a=DP.getViewport()[t]/100*a),Math.ceil(a)},getValue=function(e,t){return getScalar(e,t)+"px"},Device=/Android|webOS|iPad|BlackBerry/i,UserAgent=function(){return W.width()<768?"Mobile":Device.test(navigator.userAgent)?"Tablet":"PC"};$.extend(DP,{version:"1.0.0",defaults:{width:null,height:null,maxDate:null,minDate:null,speed:300,format:{months:null,weeks:null},types:"YYYY/MM/DD",tpl:{wrap:'<div class="sugarfun-datepicker"><div class="sugarfun-datepicker-hd"><div class="sugarfun-datepicker-tools"><button class="sugarfun-datepicker-arrow is-prev" data-value="-1">prev<i></i></button><time class="sugarfun-datepicker-times"></time><button class="sugarfun-datepicker-arrow is-next" data-value="1">next<i></i></button></div><ul class="sugarfun-datepicker-week"></ul></div><div class="sugarfun-datepicker-bd"><ul class="sugarfun-datepicker-date"></ul></div></div>',btn:".sugarfun-datepicker-button",arrow:".sugarfun-datepicker-arrow"},set:{data:null,maxDate:null,minDate:null,newDay:null,newMonth:null,newYear:null,nowDay:(new Date).getDate(),nowMonth:(new Date).getMonth(),nowYear:(new Date).getFullYear(),months:["01","02","03","04","05","06","07","08","09","10","11","12"],weeks:["日","一","二","三","四","五","六"],monthsIdx:null,monthDays:[31,28,31,30,31,30,31,31,30,31,30,31],year:null,week:0,today:null,getDays:null,setDate:null,appendDates:null,appendDate:null,formatDate:null,headerTypes:null,lastDate:{Year:null,Month:null,Day:[]},thisDate:{Year:null,Month:null,Day:[]},nextDate:{Year:null,Month:null,Day:[]},getNewDate:function(e){return new Date(e)},format:{header:function(date,format){var z={M:date.getMonth()+1};return format=format.replace(/(M+)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-2)}),format.replace(/(Y+)/g,function(e){return date.getFullYear().toString().slice(-e.length)})},inputs:function(date,format){var z={M:date.getMonth()+1,D:date.getDate(),Hour:date.getHours(),Min:date.getMinutes(),Sec:date.getSeconds()};return format=format.replace(/(M+|D+|Hour|Min|Sec)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-2)}),format.replace(/(Y+)/g,function(e){return date.getFullYear().toString().slice(-e.length)})}}}},init:function(e,t){if(e)return $.isPlainObject(t)||(t={}),$.isArray(e)||(e=isQuery(e)?$(e).get():[e]),$.each(e,function(t,a){var s={};"object"===$.type(a)&&(a.nodeType&&(a=$(a)),isQuery(a)?(s={width:a.data("width"),height:a.data("height"),speed:a.data("speed"),maxDate:a.data("max-date"),minDate:a.data("min-date"),format:"CH"===a.data("format")||"EN"===a.data("format")?a.data("format"):void 0===a.data("format")&&(a.data("months")||a.data("weeks"))?{months:a.data("months"),weeks:a.data("weeks")}:"CH",types:a.data("types"),element:a},$.metadata&&$.extend(!0,s,a.metadata())):s=a),e[t]=s}),DP.opts=$.extend(!0,{},DP.defaults,t),DP.group=e,DP._start(DP.opts.index)},selectMonth:function(e){var t=DP.coming;t.set.monthsIdx=t.set.monthsIdx+parseInt($(e).data("value"),10),t.set.monthsIdx<0?(t.set.monthsIdx=11,t.set.year--):t.set.monthsIdx>11&&(t.set.monthsIdx=0,t.set.year++),t.set.appendDates=new Date(t.set.year+"/"+t.set.months[t.set.monthsIdx]+"/"+t.set.newDay),t.date.empty(),DP._calendar(t.set.appendDates)},getValue:function(e){var t=DP.coming;$(t.element[0]).val($(e).data("date"))},_parseISO8601:function(e){var t,a=/^\s*(\d{4})-(\d\d)-(\d\d)\s*$/,s=new Date(NaN),n=a.exec(e);return n&&(t=+n[2],s.setFullYear(n[1],t-1,n[3]),t!=s.getMonth()+1&&s.setTime(NaN)),s},_start:function(e){var t,a,s,n={};return e=getScalar(e),!!(t=DP.group[e]||null)&&(n=$.extend(!0,{},DP.opts,t),n.group=DP.group,n.index=e,n.wrap=$(n.tpl.wrap),DP.coming=n,$.extend(n,{hd:$(".sugarfun-datepicker-hd",n.wrap),tools:$(".sugarfun-datepicker-tools",n.wrap),times:$(".sugarfun-datepicker-times",n.wrap),week:$(".sugarfun-datepicker-week",n.wrap),bd:$(".sugarfun-datepicker-bd",n.wrap),date:$(".sugarfun-datepicker-date",n.wrap)}),s=n.element.val()?n.element.val().substring(/(Y+)/g.exec(n.types).index,/(Y+)/g.exec(n.types).index+4)+"-"+n.element.val().substring(/(M+)/g.exec(n.types).index,/(M+)/g.exec(n.types).index+2)+"-"+n.element.val().substring(/(D+)/g.exec(n.types).index,/(D+)/g.exec(n.types).index+2):"",a=n.element.val()?new Date(s):"",DP._remove(),B.append(n.wrap),DP._calendar(a),void DP._dateOpen())},_remove:function(){var e=DP.coming;e.wrap.fadeOut(e.speed,function(){$("."+e.wrap[0].className).remove()})},_calendar:function(e){var t=DP.coming;if(t.wrap.css({top:t.element.offset().top+t.element.outerHeight(),left:t.element.offset().left,width:t.width?/%/g.test(t.width)?t.width:getScalar(t.width):t.element.width(),height:t.height?/%/g.test(t.height)?t.height:getScalar(t.height):null}).finish().fadeIn(t.speed),t.set.date=e?e:new Date,t.set.maxDate=t.maxDate?new Date(t.maxDate):new Date(9999,1,1),t.set.minDate=t.minDate?new Date(t.minDate):new Date(1,1,1),t.set.newDay=t.set.date.getDate(),t.set.newMonth=t.set.date.getMonth(),t.set.newYear=t.set.date.getYear()<=200?t.set.date.getYear()+1900:t.set.date.getYear(),t.set.monthsIdx=t.set.newMonth,t.set.year=t.set.newYear,t.set.today=t.set.format.inputs(new Date,t.types.toUpperCase()),t.set.getDays=t.set.monthDays[t.set.newMonth],t.set.setDate=t.set.date,"EN"===t.format)t.set.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t.set.weeks=["Su","Mo","Tu","We","Th","Fr","Sa"];else{if(t.format.months&&12===t.format.months.split(",").length){t.set.months=[];for(var a=0;a<t.format.months.split(",").length;a++)t.set.months.push($.trim(t.format.months.split(",")[a]))}if(t.format.weeks&&7===t.format.weeks.split(",").length){t.set.weeks=[];for(var a=0;a<t.format.weeks.split(",").length;a++)t.set.weeks.push($.trim(t.format.weeks.split(",")[a]))}}t.set.newYear%4===0&&1900!==t.set.newYear&&(t.set.monthDays[1]=29),t.week.empty();for(var a=0;a<t.set.weeks.length;a++)t.week.append("<li>"+t.set.weeks[a]+"</li>");t.set.setDate.setDate(1),2===t.set.setDate.getDate()&&(t.set.setDate=setDate(0)),t.set.setDate=t.set.setDate.getDay(),t.set.lastDate.Year=t.set.newMonth>0?t.set.year:t.set.year-1,t.set.thisDate.Year=t.set.year,t.set.nextDate.Year=t.set.newMonth<11?t.set.year:t.set.year+1,t.set.lastDate.Month=t.set.newMonth>0?t.set.months[t.set.newMonth-1]:t.set.months[11],t.set.thisDate.Month=t.set.months[t.set.newMonth],t.set.nextDate.Month=t.set.newMonth<11?t.set.months[t.set.newMonth+1]:t.set.months[0],t.set.headerTypes=t.types.toUpperCase().replace(/[-,.\/]D+|D+[-,.\/]/g,""),t.times.text(t.set.format.header(isNaN(new Date(t.set.thisDate.Year+"-"+t.set.thisDate.Month))?DP._parseISO8601(t.set.thisDate.Year+"-"+t.set.thisDate.Month+"-01"):new Date(t.set.thisDate.Year+"-"+t.set.thisDate.Month),t.set.headerTypes));for(var a=1;a<=t.set.setDate;a++)t.set.newMonth-1<0?t.set.appendDates=t.set.lastDate.Year+"/"+(t.set.lastDate.Month+"")+"/"+(t.set.monthDays[t.set.monthDays.length-1]-t.set.setDate+a+""):t.set.appendDates=t.set.lastDate.Year+"/"+(t.set.lastDate.Month+"")+"/"+(t.set.monthDays[t.set.newMonth-1]-t.set.setDate+a+""),t.set.formatDate=t.set.format.inputs(new Date(t.set.appendDates),t.types.toUpperCase()),t.set.getNewDate(t.set.appendDates)<=t.set.maxDate&&t.set.minDate&&t.set.getNewDate(t.set.appendDates)>t.set.minDate?t.set.appendDate='<button class="sugarfun-datepicker-button" data-date="'+t.set.formatDate+'">'+t.set.getNewDate(t.set.appendDates).getDate()+"</button>":t.set.appendDate="<em>"+t.set.getNewDate(t.set.appendDates).getDate()+"</em>",t.date.append('<li class="is-last">'+t.set.appendDate+"</li>"),t.set.week++;for(var a=1;a<=t.set.getDays;a++)t.set.appendDates=t.set.thisDate.Year+"/"+(t.set.thisDate.Month+"")+"/"+((a>9?a:"0"+a)+""),t.set.formatDate=t.set.format.inputs(new Date(t.set.appendDates),t.types.toUpperCase()),t.set.getNewDate(t.set.appendDates)<=t.set.maxDate&&t.set.minDate&&t.set.getNewDate(t.set.appendDates)>t.set.minDate?t.set.appendDate='<button class="sugarfun-datepicker-button" data-date="'+t.set.formatDate+'">'+a+"</button>":t.set.appendDate="<em>"+a+"</em>",t.date.append('<li class="is-this">'+t.set.appendDate+"</li>"),t.set.week++,7===t.set.week&&(t.set.week=0);for(var a=1;0!==t.set.week;a++)t.set.appendDates=t.set.nextDate.Year+"/"+(t.set.nextDate.Month+"")+"/"+((a>9?a:"0"+a)+""),t.set.formatDate=t.set.format.inputs(new Date(t.set.appendDates),t.types.toUpperCase()),t.set.getNewDate(t.set.appendDates)<=t.set.maxDate&&t.set.minDate&&t.set.getNewDate(t.set.appendDates)>t.set.minDate?t.set.appendDate='<button class="sugarfun-datepicker-button" data-date="'+t.set.formatDate+'">'+a+"</button>":t.set.appendDate="<em>"+a+"</em>",t.date.append('<li class="is-next">'+t.set.appendDate+"</li>"),t.set.week++,7===t.set.week&&(t.set.week=0)},_dateOpen:function(){var e=DP.coming;$("."+e.wrap[0].className).on("click",e.tpl.btn,function(e){e.preventDefault(),DP.getValue(this),DP._remove()}),$("."+e.wrap[0].className).on("click",e.tpl.arrow,function(e){e.preventDefault(),DP.selectMonth(this)})}}),$.fn.DatePicker=function(e){var t,a=$(this),s=this.selector||"",n=function(a){var s=$(this).focus(),n=t;a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||s.is(".sugarfun-datepicker")||(e.index=n,DP.init(s,e)!==!1&&a.preventDefault()),r(a)},r=function(e){D.on("click",function(e){e.stopPropagation(),$(e.target).is(".sugarfun-datepicker , .sugarfun-datepicker * , "+s)||DP._remove()})};return e=e||{},t=e.index||0,"PC"===UserAgent()?(s&&e.live!==!1?D.undelegate(s,"click").delegate(s,"click",n):a.unbind("click").bind("click",n),this):void a.attr("type","date")},D.ready(function(){$.extend(DP.defaults,{fixed:$.support.fixedPosition,parent:B})})}($,document,window,navigator);