!function($,document,window,navigator){"use strict";var $b=$("body"),$d=$(document),DP=$.DatePicker=function(){DP.init.apply(this,arguments)},_IE=navigator.userAgent.match(/msie/i),isQuery=function(e){return e&&e.hasOwnProperty&&e instanceof $},isString=function(e){return e&&"string"===$.type(e)},isPercentage=function(e){return isString(e)&&e.indexOf("%")>0},getScalar=function(e,t){var n=parseInt(e,10)||0;return t&&isPercentage(e)&&(n=DP.getViewport()[t]/100*n),Math.ceil(n)},getValue=function(e,t){return getScalar(e,t)+"px"},devices=function(){return/Android|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||$d.width()<768?"M":/Android|webOS|iPad|BlackBerry/i.test(navigator.userAgent)?"T":"D"},getNewDate=function(e){return new Date(e)};$.extend(DP,{version:"2.1.0",defaults:{width:null,height:null,maxDate:null,minDate:null,headType:"text",speed:300,format:{months:null,weeks:null},types:"YYYY/MM/DD"},tpl:{datepicker:"sugarfun-datepicker",hd:"sugarfun-datepicker-hd",tools:"sugarfun-datepicker-tools",arrow:"sugarfun-datepicker-arrow",times:"sugarfun-datepicker-times",week:"sugarfun-datepicker-week",frame:"sugarfun-datepicker-frame",input:"sugarfun-datepicker-input",select:"sugarfun-datepicker-select",bd:"sugarfun-datepicker-bd",date:"sugarfun-datepicker-date",btn:"sugarfun-datepicker-button",today:"is-today",chose:"is-chose"},setting:{regex:/(\w*)YYYY(.*)MM(.*)DD(.*)/g,data:null,maxDate:null,minDate:null,newDay:null,newMonth:null,newYear:null,nowDay:(new Date).getDate(),nowMonth:(new Date).getMonth(),nowYear:(new Date).getFullYear(),language:{CH:{months:["01","02","03","04","05","06","07","08","09","10","11","12"],weeks:["日","一","二","三","四","五","六"]},EN:{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weeks:["Su","Mo","Tu","We","Th","Fr","Sa"]}},months:null,weeks:null,monthsIdx:null,monthDays:[31,28,31,30,31,30,31,31,30,31,30,31],year:null,week:0,today:null,getDays:null,setDate:null,appendDates:null,appendDate:null,formatDate:null,headerTypes:null,headType:{},lastDate:{Year:null,Month:null,Day:[]},thisDate:{Year:null,Month:null,Day:[]},nextDate:{Year:null,Month:null,Day:[]}},formatHeader:function(e){var t=DP.coming,n=/(?!(\,))\d+/.exec(t.headType)?0|/(?!(\,))\d+/.exec(t.headType)[0]:1911,a=t.format.months?t.format.months.split(",")[0|DP.setting.newMonth]:DP.setting.thisDate.Month;if("text"!==t.headType){if(DP.setting.headType.ready=!0,"input"===t.headType)DP.setting.headType.year='<div class="'+DP.tpl.frame+'"><input type="text" class="'+DP.tpl.input+' is-year" value="'+DP.setting.thisDate.Year+'" maxlength="4"></div>',DP.setting.headType.month='<div class="'+DP.tpl.frame+'"><input type="text" class="'+DP.tpl.input+' is-month" value="'+DP.setting.thisDate.Month+'" maxlength="2"></div>';else if("select"===/((?!\,)\S)*/.exec(t.headType)[0]){if(DP.setting.headType.year='<div class="'+DP.tpl.frame+'"><select class="'+DP.tpl.select+' is-year">',DP.setting.nowYear>=n)for(var s=DP.setting.nowYear;s>=n;s--)DP.setting.thisDate.Year!==s?DP.setting.headType.year+='<option value="'+s+'">'+s+"</option>":DP.setting.headType.year+='<option value="'+s+'" selected>'+s+"</option>";else for(var s=DP.setting.nowYear;n+1>s;s++)DP.setting.thisDate.Year!==s?DP.setting.headType.year+='<option value="'+s+'">'+s+"</option>":DP.setting.headType.year+='<option value="'+s+'" selected>'+s+"</option>";DP.setting.headType.year+="</select></div>",DP.setting.headType.month='<div class="'+DP.tpl.frame+'"><select class="'+DP.tpl.select+' is-month">';for(var s=0,i=null;12>s;s++)i=t.format.months&&12===t.format.months.split(",").length?t.format.months.split(",")[s]:9>s?"0"+(s+1):s+1,i!==DP.setting.thisDate.Month?DP.setting.headType.month+='<option value="'+s+'">'+i+"</option>":DP.setting.headType.month+='<option value="'+s+'" selected>'+i+"</option>";DP.setting.headType.month+="</select></div>"}}else DP.setting.headType.year="<em>"+DP.setting.thisDate.Year+"</em>",DP.setting.headType.month="<em>"+a+"</em>",$("."+DP.tpl.arrow).removeClass("is-hide"),$("."+DP.tpl.tools).addClass("is-text");return DP.setting.headType.append=DP.setting.headerTypes,DP.setting.headType.append=DP.setting.headType.append.replace(/\W/.exec(DP.setting.headerTypes)[0],"<i>"+/\W/.exec(DP.setting.headerTypes)[0]+"</i>"),DP.setting.headType.append=DP.setting.headType.append.replace(/Y+/g,DP.setting.headType.year),DP.setting.headType.append=DP.setting.headType.append.replace(/M+/g,DP.setting.headType.month),DP.setting.headType.append},formatInputs:function(date,format){var z={M:date.getMonth()+1,D:date.getDate(),Hour:date.getHours(),Min:date.getMinutes(),Sec:date.getSeconds()};return format=format.replace(/(M+|D+|Hour|Min|Sec)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-2)}),format.replace(/(Y+)/g,function(e){return date.getFullYear().toString().slice(-e.length)})},init:function(e,t){return e?($.isPlainObject(t)||(t={}),$.isArray(e)||(e=isQuery(e)?$(e).get():[e]),$.each(e,function(t,n){var a={};"object"===$.type(n)&&(n.nodeType&&(n=$(n)),isQuery(n)?(a={width:n.data("width"),height:n.data("height"),speed:n.data("speed"),maxDate:n.data("max-date"),minDate:n.data("min-date"),headType:n.data("head-type"),format:"CH"===n.data("format")||"EN"===n.data("format")?n.data("format"):void 0===n.data("format")&&(n.data("months")||n.data("weeks"))?{months:n.data("months"),weeks:n.data("weeks")}:"CH",types:n.data("types"),element:n},$.metadata&&$.extend(!0,a,n.metadata())):a=n),e[t]=a}),DP.opts=$.extend(!0,{},DP.defaults,t),DP.group=e,DP._start(DP.opts.index)):void 0},selectMonth:function(e){DP.coming;DP.setting.monthsIdx=DP.setting.monthsIdx+parseInt($(e).data("value"),10),DP.setting.monthsIdx<0?(DP.setting.monthsIdx=11,DP.setting.year--):DP.setting.monthsIdx>11&&(DP.setting.monthsIdx=0,DP.setting.year++),DP.setting.appendDates=DP.defaults.types.replace(DP.setting.regex,"$1"+DP.setting.year+"$2"+DP.setting.months[DP.setting.monthsIdx]+"$3"+DP.setting.newDay),DP.setting.appendDates=new Date(DP.setting.appendDates),$("."+DP.tpl.date).empty(),DP._calendar(DP.setting.appendDates)},formSelect:function(e){var t=(DP.coming,null);e.hasClass("is-year")&&(DP.setting.year=0|e.val()),t=new Date(DP.defaults.types.replace(DP.setting.regex,"$1"+DP.setting.year+"$2"+DP.setting.months[e.val().length<=2&&e.val()?e.hasClass(DP.tpl.input)?(0|e.val())-1:0|e.val():DP.setting.newMonth]+"$3"+DP.setting.newDay)),$("."+DP.tpl.date).empty(),DP._calendar(t)},getValue:function(e){var t=DP.coming;$(t.element[0]).val($(e).data("date"))},_start:function(e){var t,n,a,s,i,D={};return e=getScalar(e),(t=DP.group[e]||null)?(D=$.extend(!0,{},DP.opts,t),DP.tpl.wrap='<div class="'+DP.tpl.datepicker+'"><div class="'+DP.tpl.hd+'"><div class="'+DP.tpl.tools+'"><button class="'+DP.tpl.arrow+' is-prev" data-value="-1">prev<i></i></button><div class="'+DP.tpl.times+'"></div><button class="'+DP.tpl.arrow+' is-next" data-value="1">next<i></i></button></div><ul class="'+DP.tpl.week+'"></ul></div><div class="'+DP.tpl.bd+'"><ul class="'+DP.tpl.date+'"></ul></div></div>',DP.coming=D,DP.setting.headType.ready=!1,a=D.element.val()?0|D.element.val().substring(/Y+/.exec(D.types).index,/Y+/.exec(D.types).index+/Y+/.exec(D.types)[0].length):"",s=D.element.val()?0|D.element.val().substring(/M+/.exec(D.types).index,/M+/.exec(D.types).index+/M+/.exec(D.types)[0].length):"",i=D.element.val()?0|D.element.val().substring(/D+/.exec(D.types).index,/D+/.exec(D.types).index+/D+/.exec(D.types)[0].length):"",n=D.element.val()?new Date(DP.defaults.types.replace(DP.setting.regex,"$1"+a+"$2"+DP.setting.months[s-1]+"$3"+i)):"",DP._remove(),$b.append(DP.tpl.wrap),DP._calendar(n),void DP._dateOpen()):!1},_remove:function(){var e=DP.coming;0!==$("."+DP.tpl.datepicker).length&&$("."+DP.tpl.datepicker).fadeOut(e.speed,function(){$(this).remove()})},_calendar:function(e){var t,n,a,s=DP.coming;if($("."+DP.tpl.datepicker).css({top:s.element.offset().top+s.element.outerHeight(),left:s.element.offset().left,width:s.width?/%/g.test(s.width)?s.width:getScalar(s.width):s.element.outerWidth(),height:s.height?/%/g.test(s.height)?s.height:getScalar(s.height):null}).finish().fadeIn(s.speed),DP.setting.date=e?e:new Date,DP.setting.maxDate=s.maxDate?new Date(s.maxDate):new Date(9999,1,1),DP.setting.minDate=s.minDate?new Date(s.minDate):new Date(1,1,1),DP.setting.newDay=DP.setting.date.getDate(),DP.setting.newMonth=DP.setting.date.getMonth(),DP.setting.newYear=DP.setting.date.getYear()<=200?DP.setting.date.getYear()+1900:DP.setting.date.getYear(),DP.setting.monthsIdx=DP.setting.newMonth,DP.setting.year=DP.setting.newYear,DP.setting.today=DP.formatInputs(new Date,s.types.toUpperCase()),DP.setting.getDays=DP.setting.monthDays[DP.setting.newMonth],DP.setting.setDate=DP.setting.date,"EN"===s.format)DP.setting.months=DP.setting.language.EN.months,DP.setting.weeks=DP.setting.language.EN.weeks;else if(DP.setting.months=DP.setting.language.CH.months,DP.setting.weeks=DP.setting.language.CH.weeks,s.format.weeks&&7===s.format.weeks.split(",").length){DP.setting.weeks=[];for(var i=0;i<s.format.weeks.split(",").length;i++)DP.setting.weeks.push($.trim(s.format.weeks.split(",")[i]))}DP.setting.newYear%4===0&&1900!==DP.setting.newYear&&(DP.setting.monthDays[1]=29),$("."+DP.tpl.week).empty();for(var i=0;i<DP.setting.weeks.length;i++)$("."+DP.tpl.week).append("<li>"+DP.setting.weeks[i]+"</li>");DP.setting.setDate.setDate(1),2===DP.setting.setDate.getDate()&&(DP.setting.setDate=setDate(0)),DP.setting.setDate=DP.setting.setDate.getDay(),DP.setting.lastDate.Year=DP.setting.newMonth>0?DP.setting.year:DP.setting.year-1,DP.setting.thisDate.Year=DP.setting.year,DP.setting.nextDate.Year=DP.setting.newMonth<11?DP.setting.year:DP.setting.year+1,DP.setting.lastDate.Month=DP.setting.newMonth>0?DP.setting.months[DP.setting.newMonth-1]:DP.setting.months[11],DP.setting.thisDate.Month=DP.setting.months[DP.setting.newMonth],DP.setting.nextDate.Month=DP.setting.newMonth<11?DP.setting.months[DP.setting.newMonth+1]:DP.setting.months[0],DP.setting.headerTypes=s.types.toUpperCase().replace(/[-,.\/]D+|D+[-,.\/]/g,""),DP.setting.headType.date=DP.setting.headerTypes,DP.setting.headType.date=DP.setting.headType.date.replace(/Y+/g,DP.setting.thisDate.Year),DP.setting.headType.date=DP.setting.headType.date.replace(/M+/g,DP.setting.thisDate.Month),DP.setting.headType.ready||$("."+DP.tpl.times).html(DP.formatHeader(DP.setting.headType.date));for(var i=1;i<=DP.setting.setDate;i++)t=DP.setting.newMonth-1<0?DP.setting.monthDays[DP.setting.monthDays.length-1]-DP.setting.setDate+i:DP.setting.monthDays[DP.setting.newMonth-1]-DP.setting.setDate+i,DP.setting.appendDates=DP.defaults.types.replace(DP.setting.regex,"$1"+DP.setting.lastDate.Year+"$2"+DP.setting.lastDate.Month+"$3"+t),DP.setting.formatDate=DP.formatInputs(new Date(DP.setting.appendDates),s.types.toUpperCase()),a=s.element.val()===DP.setting.formatDate?" "+DP.tpl.chose:"",getNewDate(DP.setting.appendDates)<=DP.setting.maxDate&&DP.setting.minDate&&getNewDate(DP.setting.appendDates)>DP.setting.minDate?DP.setting.appendDate='<button class="sugarfun-datepicker-button'+a+'" data-date="'+DP.setting.formatDate+'">'+getNewDate(DP.setting.appendDates).getDate()+"</button>":DP.setting.appendDate='<em class="'+a+'">'+getNewDate(DP.setting.appendDates).getDate()+"</em>",$("."+DP.tpl.date).append('<li class="is-last">'+DP.setting.appendDate+"</li>"),DP.setting.week++;for(var i=1;i<=DP.setting.getDays;i++)t=i>9?i:"0"+i,DP.setting.appendDates=DP.defaults.types.replace(DP.setting.regex,"$1"+DP.setting.thisDate.Year+"$2"+DP.setting.thisDate.Month+"$3"+t),DP.setting.formatDate=DP.formatInputs(new Date(DP.setting.appendDates),s.types.toUpperCase()),n=DP.setting.today===DP.setting.formatDate?" "+DP.tpl.today:"",a=s.element.val()===DP.setting.formatDate?" "+DP.tpl.chose:"",getNewDate(DP.setting.appendDates)<=DP.setting.maxDate&&DP.setting.minDate&&getNewDate(DP.setting.appendDates)>DP.setting.minDate?DP.setting.appendDate='<button class="sugarfun-datepicker-button'+n+a+'" data-date="'+DP.setting.formatDate+'">'+i+"</button>":DP.setting.appendDate='<em class="'+n+a+'">'+i+"</em>",$("."+DP.tpl.date).append('<li class="is-this">'+DP.setting.appendDate+"</li>"),DP.setting.week++,7===DP.setting.week&&(DP.setting.week=0);for(var i=1;0!==DP.setting.week;i++)t=i>9?i:"0"+i,DP.setting.appendDates=DP.defaults.types.replace(DP.setting.regex,"$1"+DP.setting.nextDate.Year+"$2"+DP.setting.nextDate.Month+"$3"+t),DP.setting.formatDate=DP.formatInputs(new Date(DP.setting.appendDates),s.types.toUpperCase()),a=s.element.val()===DP.setting.formatDate?" "+DP.tpl.chose:"",getNewDate(DP.setting.appendDates)<=DP.setting.maxDate&&DP.setting.minDate&&getNewDate(DP.setting.appendDates)>DP.setting.minDate?DP.setting.appendDate='<button class="sugarfun-datepicker-button'+a+'" data-date="'+DP.setting.formatDate+'">'+i+"</button>":DP.setting.appendDate='<em class="'+a+'">'+i+"</em>",$("."+DP.tpl.date).append('<li class="is-next">'+DP.setting.appendDate+"</li>"),DP.setting.week++,7===DP.setting.week&&(DP.setting.week=0)},_dateOpen:function(){DP.coming;$("."+DP.tpl.datepicker).on("click","."+DP.tpl.btn,function(e){e.preventDefault(),DP.getValue(this),DP._remove()}),$("."+DP.tpl.datepicker).on("click","."+DP.tpl.arrow,function(e){e.preventDefault(),DP.selectMonth(this)}),$("."+DP.tpl.datepicker).on("blur keydown","."+DP.tpl.input,function(e){var t=$(this);("focusout"===e.type||"keydown"===e.type&&13===e.which)&&DP.formSelect(t)}),$("."+DP.tpl.datepicker).on("change","."+DP.tpl.select,function(e){var t=$(this);DP.formSelect(t)})}}),$.fn.DatePicker=function(e){var t,n=$(this),a=this.selector||"",s=function(n){var a=$(this).focus(),s=t;n.ctrlKey||n.altKey||n.shiftKey||n.metaKey||a.is(".sugarfun-datepicker")||(e.index=s,DP.init(a,e)!==!1&&n.preventDefault()),i(n)},i=function(e){$d.on("click",function(e){e.stopPropagation(),$(e.target).is(".sugarfun-datepicker , .sugarfun-datepicker * , "+a)||DP._remove()})};return e=e||{},t=e.index||0,"D"===devices()?(a&&e.live!==!1?$d.undelegate(a,"click").delegate(a,"click",s):n.unbind("click").bind("click",s),this):void n.attr("type","date")},$d.ready(function(){$.extend(DP.defaults,{fixed:$.support.fixedPosition,parent:$b})})}($,document,window,navigator);